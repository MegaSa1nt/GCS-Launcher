<head>
	<meta charset="utf-8">
	<title>GreenCatsServer!</title>
	<script src="script.js"></script>
	<script src="res/jsz.js"></script>
	<link async="" rel="stylesheet" href="res/style.css">
	<link async="" rel="stylesheet" href="res/main.css">
</head>
<body oncontextmenu="return false;">

<div id="stgdiv" class="fillbg" style="opacity:0;visibility:hidden">
	<div class="loadsvg" style="flex-direction: column;">
		<button style="left: 12.5;top: 12.5" type="button" title="Закрыть настройки" onclick="settings()" class="login"><img class="playicon" width="30px" src="res/svg/x.svg"></button>
		<h1>Настройки</h1>
		<div class="form setform">
			<div class="settings">
				<p class="settitle">Сервер</p>
				<h2>Загружать клиент</h2>
				<div class="radios"><span><input id="gdhmyes" type="radio" name="gdhm" value="1"><text>С GDHM</text></span></input>
				<span><input type="radio" id="gdhmno" name="gdhm" value="0"><text>Без GDHM</text></input></span></div>
			</div>
			<button type="button" class="loginstg" style="margin-bottom:5px" title="Папка с игрой" onclick="openDir('res')"><p>Открыть папку с игрой</p><img class="playicon" width="25px" src="res/svg/folder.svg"></button>
		</div>
		<div class="form setform">
			<div class="settings">
				<p class="settitle">Клиент</p>
				<h2>При закрытии клиента</h2>
				<div class="radios"><span><input id="clienthide" type="radio" name="clientcl" value="1"><text>Скрывать в трей</text></span></input>
				<span><input type="radio" id="clientclose" name="clientcl" value="0"><text>Закрывать</text></input></span></div>
				<h2>Системные уведомления</h2>
				<div class="radios"><span><input id="usenf" type="radio" name="notifies" value="1"><text>Включить</text></span></input>
				<span><input type="radio" id="nousenf" name="notifies" value="0"><text>Отключить</text></input></span></div>
			</div>
		</div>
		<button type="button" class="loginstg" title="Выход" onclick="logoutbtn()"><p>Выйти из аккаунта</p><img class="playicon" width="25px" src="res/svg/login.svg"></button>
	</div>
	<div class="ver"><h3><b><span id="time">26 октября 2006</span></b></h3><h3><b><span id="ver">1.2.0</span></b></h3></div>
	<span class="loading"></span>
</div>

<div id="loaddiv" class="fillbg">
	<div class="loadsvg">
		<div id="nointernet" style="opacity:0; visibility: hidden;  transition: 0.3s; display: none; flex-wrap: wrap; justify-content: center;">
			<p style="font-size: 25px;margin-top: 10px;color: white;">Проверьте ваше подключение к интернету...</p>
			<button class="btn-primary btn-success btn-play" onclick="play()">Играть</button>
		</div>
		<img class="spin" width="50px" src="res/svg/loading.svg">
		<img  width="300px" src="res/svg/sleeping.svg">
	</div>
	<span class="loading"></span>
</div>

<div id="notifydiv" class="fillbg" style="opacity:0;visibility:hidden">
	<div class="loadsvg" style="flex-direction: column;">
		<button style="left: 12.5;top: 12.5" type="button" title="Закрыть уведомления" onclick="show('n')" class="login"><img class="playicon" width="30px" src="res/svg/x.svg"></button>
		<h1>Уведомления</h1>
		<div class="settings notifies" id="notifies">
			<img class="spin" width="75px" src="res/svg/loading.svg">
		</div>
		<div class="notifycountdiv"><p class="nfcount1" id="notifycount"><i>0 всего, 0 новых уведомлений</i></p><button class="nfcount2" onclick="detailedNotify('all')">| Прочитать всё</button></div>
	</div>
	<span class="loading"></span>
</div>

<div id="warndiv" class="fillbg" style="opacity:0;visibility:hidden">
	<div class="loadsvg warntext" style="flex-direction: column;">
		<h1>Предупреждение</h1><br>
		<p><b>Привет, игрок!</b></p>
		<p>Будь аккуратнее: игра установится в ту же папку, где находится клиент.</p><br>
		<p><i>Ты уверен, что поместил клиент в нужную тебе папку?</i></p><br>
		<div class="warnbtn"><button type="button" onclick="warning(true)" class="btn-primary btn-success">Да, пусти меня!</button><button type="button" onclick="warning(false)" style="width:70%" class="btn-primary btn-size">Подожди, я перемещу...</button></div>
	</div>
	<span class="loading"></span>
</div>

<div class="mahbody">
	<div data-tauri-drag-region class="titlebar">
	  <div class="titlebar-button" id="titlebar-minimize">
		<img src="res/svg/min.svg" width="10px" alt="Свернуть"/>
	  </div>
	  <div class="titlebar-button-close" id="titlebar-close">
		<img src="res/svg/x.svg" width="10px" alt="Закрыть" />
	  </div>
	</div>
	<button type="button" style="opacity:1;transition:0.3s" title="Вход" onclick="show()" id="lbtn" class="login"><img id="licon" class="playicon" width="35px" src="res/svg/login.svg"></button>
	<button type="button" style="opacity:0;visibility:hidden;transition:0.3s;top: 35px;left: auto;right: 5px;" title="Уведомления" onclick="show('n')" id="nbtn" class="login">
		<div class="nfcircle" id="mainnfcircle" style="display: none"><img src="res/svg/circle.svg" class="notifycircle" width="8px"></div>
		<img class="playicon" width="20px" src="res/svg/bell.svg">
	</button>
	<div id="div" class="dropdown-menu">
		<form class="form" id="form" name="login">
			<p id="ltext" style="padding:5px">Войдите в аккаунт</p>
			<div class="form-group"><input autocomplete="current-username" name="userName" placeholder="Никнейм" class="form-control login-input"></input></div>
			<div class="form-group"><input autocomplete="current-password" type="password" name="password" placeholder="Пароль" class="form-control login-input"></input></div>
			<button type="button" onclick="loginbtn()" id="loginbutton" class="btn-primary">Войти</button>
		</form>
	</div>
	<div class="maindiv">
		<h1>Здравствуй, <text id="user" style="padding:0;font-weight: 900;">гость</text>!</h1>
		<p id="bruh">Добро пожаловать на <text onclick="window.__TAURI__.shell.open('https://gcs.icu/')" style="color: #3EE667; cursor: pointer;">GreenCatsServer</text>!</p>
		<h3 id="text" style="color: gray"></h3>
		<div class="prdiv" id="prdiv" style="opacity:0">
			<div class="prtext"><p class="prp" id="ploaded">0 МБ</p><p class="prp" id="ptxt">Загрузка...</p><p class="prp" id="pmax">310.1 МБ</p></div>
			<progress id="progress" style="transition:0.2s" value="100" max="100"></progress>
		</div>
		<button id="pbtn" style="border-radius: 500px;" onclick="play()"><div id="playdiv" class="play"><img class="dl" id="pimg" width="100px" src="res/svg/play.svg"></div></button>
	</div>
	<script>
		document.addEventListener('keydown', event => {
			switch(event.key) {
				case 'F5':
					event.preventDefault();
					return false;
					break;
				case 'Enter':
					if(document.getElementById("div").classList.contains('show')) document.getElementById("loginbutton").click();
					break;
			}
			return true;
		});
		window.dontupdate = window.dontplayagain = false;
		var cook = [];
		window.oldNotifies = [];
		cookie = document.cookie.split(";");
		cookie.forEach((penis) => {
			variable = penis.split("=");
			cook[variable[0].trim()] = variable[1];
		});
		if(!window.localStorage.modmenu) document.getElementById("gdhmno").click();
		else document.getElementById("gdhmyes").click();
		if(window.localStorage.closeorhide == 'false') document.getElementById("clienthide").click();
		else document.getElementById("clientclose").click();
		if(window.localStorage.usenf == 'true') document.getElementById("usenf").click();
		else document.getElementById("nousenf").click();
		document.getElementById("clienthide").addEventListener("change", function() {window.localStorage.closeorhide = 'false';})
		document.getElementById("clientclose").addEventListener("change", function() {window.localStorage.closeorhide = 'true';})
		document.getElementById("nousenf").addEventListener("change", function() {window.localStorage.usenf = 'false';})
		document.getElementById("usenf").addEventListener("change", function() {window.localStorage.usenf = 'true';})
		document.getElementById("gdhmyes").addEventListener("change", function() {window.localStorage.modmenu = true;})
		document.getElementById("gdhmno").addEventListener("change", function() {window.localStorage.modmenu = false;})
		if(!window.localStorage.usenf) window.localStorage.usenf = 'true';
		if(!window.localStorage.closeorhide) window.localStorage.usenf = 'false';
		if(!window.oldtext) window.oldtext = '';
		if(!window.oldcolor) window.oldcolor = '';
		const appWindow = window.__TAURI__.window.appWindow;
		document.getElementById('titlebar-minimize').addEventListener('click', () => appWindow.minimize());
		document.getElementById('titlebar-close').addEventListener('click', () => {
			if(window.localStorage.closeorhide == 'false') {
				if(window.localStorage.firstHide != 'seen' && window.localStorage.usenf == 'false') {
					window.__TAURI__.notification.sendNotification({title: "Клиент ушёл в трей!", body: 'Клиент находится в трее, откуда вы сможете его открыть или закрыть. Если мешает — загляните в настройки!', icon: "res/kitty.png"});
					window.localStorage.firstHide = 'seen';
				}
				appWindow.hide();
			}
			else appWindow.close();
		});
		const text = document.getElementById("text");
		const ltext = document.getElementById("ltext");
		setTimeout(function(){updateUser();}, 1);
		setInterval(function(){updateUser()}, 1800000);
		setInterval(function(){updateNotifies()}, 90000);
		window.__TAURI__.window.appWindow.setFocus();
		window.__TAURI__.fs.exists("GCS-Updater.exe").then((result) => {if(result) window.__TAURI__.fs.removeFile("GCS-Updater.exe")});
		tm = timeConverter(cook["client"]);
		if(tm != "1 января 1970" && tm != 'NaN undefined NaN') document.getElementById("time").innerHTML = tm;
		f = window.__TAURI__.app.getVersion();
		f.then(ve=>{
			document.getElementById("ver").innerHTML = ve;
			window.appVer = ve;
		})
		setInterval(function() {
			checkProcess('GreenCatsServer.exe').then(r => {
				window.dontplayagain = r;
				if(text.innerHTML != "Игра запущена!" && text.innerHTML != "Закройте игру!" && text.innerHTML != "Загрузка...") window.oldtext = text.innerHTML;
				if(text.style.color != "rgb(187, 255, 187)" && text.style.color != "rgb(255, 187, 187)") window.oldcolor = text.style.color;
				if(r) {
					if(!window.dontupdate) {
						text.innerHTML = "Игра запущена!";
						text.style.color = "#bbffbb";
					} else {
						text.innerHTML = "Закройте игру!";
						text.style.color = "#ffbbbb";
					}
				} else {
					text.innerHTML = window.oldtext;
					text.style.color = window.oldcolor;
				}
			})
		}, 2000);
	</script>
</div></body>